import{n as wt,s as At,t as xt,e as We,o as Et,h as St,g as Ct,f as Ot,c as Bt,b as Nt,a as Tt}from"./main-BRfU9jQo.js";import{t as l,h as H,A as L,i as U,X as It,S as Pt,e as E,I as B,a as p,o as h,r as Ht,b as R,c as Be,x as Lt,P as ze,n as T,j as Mt,_ as Gt}from"./index-DutTdvUt.js";const qe="Block",Re="Call",Je="Element",Ke="AppendPath",S="AppendExpr",Ue="Literal",Ye="Modifier",Xe="DynamicComponent",Ze="Comment",ge="Splat",Qe="Keyword",et="Local",tt="Free",Y="Block",rt="This",O="Literal",V="Call",le="GetPath",ie="GetVar",ve="Concat",be="HasBlock",we="HasBlockParams",Dt=0,Ft=1,Vt=2,Ne="http://www.w3.org/2000/xmlns/";function N(t){return!!t&&t.length>0}function nt(t,e){if(t===null)return null;let r=[];for(let n of t)r.push(e(n));return r}function st(t){return Array.isArray(t)?function(e){if(!Array.isArray(e))return!1;const r=e[0];if(typeof r=="number")switch(r){case 0:case 5:case 6:case 7:case 8:return!0;default:return!1}return r[0]==="("}(t)?He(t):function(e){if(Array.isArray(e)&&typeof e[0]=="string")switch(e[0][0]){case"(":case"#":case"<":case"!":return!0;default:return!1}return!1}(t)?function(e){const r=e[0];switch(r[0]){case"(":{let n=null,s=null;return e.length===3?(n=C(e[1]),s=F(e[2])):e.length===2&&(Array.isArray(e[1])?n=C(e[1]):s=F(e[1])),{kind:Re,head:$(r),params:n,hash:s,trusted:!1}}case"#":{const{head:n,params:s,hash:a,blocks:i,blockParams:o}=Te(e);return{kind:qe,head:n,params:s,hash:a,blocks:i,blockParams:o}}case"!":{const n=e[0].slice(1),{params:s,hash:a,blocks:i,blockParams:o}=Te(e);return{kind:Qe,name:n,params:s,hash:a,blocks:i,blockParams:o}}case"<":{let n=H(),s=[];return e.length===3?(n=Pe(e[1]),s=_(e[2])):e.length===2&&(Array.isArray(e[1])?s=_(e[1]):n=Pe(e[1])),{kind:Je,name:_t(r),attrs:n,block:s}}default:throw new Error(`Unreachable ${JSON.stringify(e)} in normalizeSugaryArrayStatement`)}}(t):function(e){switch(e[0]){case 0:return{kind:Ue,value:e[1]};case 2:return He(e[1],e[2]);case 3:return{kind:Ye,params:C(e[1]),hash:F(e[2])};case 4:return{kind:Xe,expr:q(e[1]),hash:F(e[2]),block:_(e[3])};case 1:return{kind:Ze,value:e[1]}}}(t):typeof t=="string"?fe(z(t),!1):void L(t)}function fe(t,e){return t.type===le?{kind:Ke,path:t,trusted:e}:{kind:S,expr:t,trusted:e}}function $t(t){const e=/^(#|!)(.*)$/u.exec(t);if(e===null)throw new Error("Unexpected missing # in block head");return z(e[2])}function $(t){const e=/^\((.*)\)$/u.exec(t);if(e===null)throw new Error("Unexpected missing () in call head");return z(e[1])}function at(t,e=[]){const r=lt(t);return N(e)?{type:le,path:{head:r,tail:e}}:{type:ie,variable:r}}function z(t){const{kind:e,name:r}=lt(t),[n,...s]=r.split("."),a={kind:e,name:n,mode:"loose"};return N(s)?{type:le,path:{head:a,tail:s}}:{type:ie,variable:a}}function lt(t){let e,r;if(/^this(?:\.|$)/u.test(t))return{kind:rt,name:t,mode:"loose"};switch(t[0]){case"^":e=tt,r=t.slice(1);break;case"@":e="Arg",r=t.slice(1);break;case"&":e=Y,r=t.slice(1);break;default:e=et,r=t}return{kind:e,name:r,mode:"loose"}}function Te(t){const e=t[0];let r=H(),n=null,s=null,a=null;return t.length===2?r=pe(t[1]):t.length===3?(Array.isArray(t[1])?n=C(t[1]):{hash:s,blockParams:a}=Ie(t[1]),r=pe(t[2])):(n=C(t[1]),{hash:s,blockParams:a}=Ie(t[2]),r=pe(t[3])),{head:$t(e),params:n,hash:s,blockParams:a,blocks:r}}function Ie(t){if(t===null)return{hash:null,blockParams:null};let e=null,r=null;return function(n,s){Object.keys(n).forEach(a=>{const i=n[a];s(a,i)})}(t,(n,s)=>{n==="as"?r=Array.isArray(s)?s:[s]:(e=e||H(),e[n]=q(s))}),{hash:e,blockParams:r}}function pe(t){return Array.isArray(t)?{default:_(t)}:Ae(t,_)}function _(t){return t.map(e=>st(e))}function Pe(t){return Ae(t,e=>{return(r=e,r==="splat"?{expr:ge,trusted:!1}:{expr:q(r)}).expr;var r})}function Ae(t,e){const r=H();return Object.keys(t).forEach(n=>{r[n]=e(t[n],n)}),r}function _t(t){return/^<([\d\-a-z][\d\-A-Za-z]*)>$/u.exec(t)?.[1]??null}function He(t,e=!1){if(t==null)return{expr:{type:O,value:t},kind:S,trusted:!1};if(Array.isArray(t))switch(t[0]){case 0:return{expr:{type:O,value:t[1]},kind:S,trusted:!1};case 5:return fe(at(t[1],t[2]),e);case 6:return{expr:{type:ve,params:C(t.slice(1))},kind:S,trusted:e};case 7:return{expr:{type:be,name:t[1]},kind:S,trusted:e};case 8:return{expr:{type:we,name:t[1]},kind:S,trusted:e};default:if(it(t))return{expr:ot(t),kind:S,trusted:e};throw new Error(`Unexpected array in expression position (wasn't a tuple expression and ${t[0]} isn't wrapped in parens, so it isn't a call): ${JSON.stringify(t)}`)}else if(typeof t!="object")switch(typeof t){case"string":return fe(z(t),e);case"boolean":case"number":return{expr:{type:O,value:t},kind:S,trusted:!0};default:L(t)}else L(t)}function q(t){if(t==null)return{type:O,value:t};if(Array.isArray(t))switch(t[0]){case 0:return{type:O,value:t[1]};case 5:return at(t[1],t[2]);case 6:return{type:ve,params:C(t.slice(1))};case 7:return{type:be,name:t[1]};case 8:return{type:we,name:t[1]};default:if(it(t))return ot(t);throw new Error(`Unexpected array in expression position (wasn't a tuple expression and ${t[0]} isn't wrapped in parens, so it isn't a call): ${JSON.stringify(t)}`)}else if(typeof t!="object")switch(typeof t){case"string":return z(t);case"boolean":case"number":return{type:O,value:t};default:L(t)}else L(t)}function it(t){return typeof t[0]=="string"&&t[0][0]==="("}function C(t){return t.map(q)}function F(t){return t===null?null:Ae(t,q)}function ot(t){switch(t.length){case 1:return{type:V,head:$(t[0]),params:null,hash:null};case 2:return Array.isArray(t[1])?{type:V,head:$(t[0]),params:C(t[1]),hash:null}:{type:V,head:$(t[0]),params:null,hash:F(t[1])};case 3:return{type:V,head:$(t[0]),params:C(t[1]),hash:F(t[2])}}}class ct{toSymbols(){return this._symbols.slice(1)}toUpvars(){return this._freeVariables}freeVar(e){return me(this._freeVariables,e)}block(e){return this.symbol(e)}arg(e){return me(this._symbols,e)}local(e){throw new Error(`No local ${e} was found. Maybe you meant ^${e} for upvar, or !${e} for keyword?`)}this(){return 0}hasLocal(e){return!1}symbol(e){return me(this._symbols,e)}child(e){return new xe(this,e)}constructor(){this._freeVariables=[],this._symbols=["this"],this.top=this}}class xe{constructor(e,r){this.parent=e,this.locals=H();for(let n of r)this.locals[n]=e.top.symbol(n)}get paramSymbols(){return Pt(this.locals)}get top(){return this.parent.top}freeVar(e){return this.parent.freeVar(e)}arg(e){return this.parent.arg(e)}block(e){return this.parent.block(e)}local(e){return e in this.locals?this.locals[e]:this.parent.local(e)}this(){return this.parent.this()}hasLocal(e){return e in this.locals||this.parent.hasLocal(e)}child(e){return new xe(this,e)}}function me(t,e){let r=t.indexOf(e);return r===-1&&(r=t.length,t.push(e)),r}function Le(t){return new Error(`unimplemented ${t}`)}function jt(t,e){let r=[];return t.forEach(n=>r.push(...oe(st(n),e))),r}function Wt(t,e){let r=[];return t.forEach(n=>r.push(...oe(n,e))),r}function oe(t,e=new ct){switch(t.kind){case Ke:return[[t.trusted?l.TrustingAppend:l.Append,Ee(t.path,e)]];case S:return[[t.trusted?l.TrustingAppend:l.Append,M(t.expr,t.trusted?"TrustedAppend":"Append",e)]];case Re:{let{head:r,params:n,hash:s,trusted:a}=t,i=n?X(n,e):null,o=s?ke(s,e):null,u=ye(r,a?E.ResolveAsHelperHead:E.ResolveAsComponentOrHelperHead,e);return[[a?l.TrustingAppend:l.Append,[l.Call,u,i,o]]]}case Ue:return[[l.Append,t.value]];case Ze:return[[l.Comment,t.value]];case qe:{let r=function(i,o,u){let y=[],k=[];for(const[b,A]of Object.entries(i))if(y.push(b),b==="default"){let x=u.child(o||[]);k.push(Z(A,x,x.paramSymbols))}else k.push(Z(A,u,[]));return[y,k]}(t.blocks,t.blockParams,e),n=ke(t.hash,e),s=X(t.params,e),a=ye(t.head,E.ResolveAsComponentHead,e);return[[l.Block,a,s,n,r]]}case Qe:return[Kt(t,e)];case Je:return function({name:r,attrs:n,block:s},a){let i=[Ut(n)?[l.OpenElementWithSplat,r]:[l.OpenElement,r]];if(n){let{params:o}=function(u,y){let k=[],b=[],A=[];for(const[x,ue]of Object.entries(u))ue===ge?k.push([l.AttrSplat,y.block("&attrs")]):x[0]==="@"?(b.push(x),A.push(M(ue,"Strict",y))):k.push(...Xt(x,ue,Yt(x),y));return{params:k,args:N(b)&&N(A)?[b,A]:null}}(n,a);i.push(...o)}return i.push([l.FlushElement]),Array.isArray(s)&&s.forEach(o=>i.push(...oe(o,a))),i.push([l.CloseElement]),i}(t,e);case Ye:throw Le("modifier");case Xe:throw Le("dynamic component");default:L(t)}}function zt(t,...e){return[0,t.reduce((r,n,s)=>r+`${n}${e[s]?String(e[s]):""}`,"")]}function qt(t,...e){return[1,t.reduce((r,n,s)=>r+`${n}${e[s]?String(e[s]):""}`,"")]}function Rt(t){return String.fromCharCode(parseInt(t,16))}const Jt=`
`;function Kt(t,e){let{name:r}=t,n=X(t.params,e),s=e.child(t.blockParams||[]),a=Z(t.blocks.default,s,s.paramSymbols),i=t.blocks.else?Z(t.blocks.else,e,[]):null;switch(r){case"let":return[l.Let,n,a];case"if":return[l.If,n[0],a,i];case"each":{let o=t.hash?t.hash.key:null,u=o?M(o,"Strict",e):null;return[l.Each,n[0],u,a,i]}default:throw new Error("unimplemented keyword")}}function Ut(t){return t!==null&&Object.keys(t).some(e=>t[e]===ge)}function Yt(t){if(t==="xmlns")return Ne;let e=/^([^:]*):([^:]*)$/u.exec(t);if(e===null)return null;switch(e[1]){case"xlink":return"http://www.w3.org/1999/xlink";case"xml":return"http://www.w3.org/XML/1998/namespace";case"xmlns":return Ne}return null}function Xt(t,e,r,n){if(e.type===O){let s=e.value;if(s===!1)return[];if(s===!0)return[[l.StaticAttr,t,"",r??void 0]];if(typeof s=="string")return[[l.StaticAttr,t,s,r??void 0]];throw new Error(`Unexpected/unimplemented literal attribute ${JSON.stringify(s)}`)}return[[l.DynamicAttr,t,M(e,"AttrValue",n),r??void 0]]}function Me(t,e){switch(t){case"Append":return e?"AppendBare":"AppendInvoke";case"TrustedAppend":return e?"TrustedAppendBare":"TrustedAppendInvoke";case"AttrValue":return e?"AttrValueBare":"AttrValueInvoke";default:return t}}function M(t,e,r){switch(t.type){case le:return Ee(t,r);case ie:return j(t.variable,Me(e,!0),r);case ve:return[l.Concat,Zt(t.params,r)];case V:{let n=X(t.params,r),s=ke(t.hash,r),a=ye(t.head,e==="Strict"?"SubExpression":Me(e,!1),r);return[l.Call,a,n,s]}case be:return[l.HasBlock,j({kind:Y,name:t.name},E.Strict,r)];case we:return[l.HasBlockParams,j({kind:Y,name:t.name},E.Strict,r)];case O:return t.value===void 0?[l.Undefined]:t.value;default:L(t)}}function ye(t,e,r){return t.type===ie?j(t.variable,e,r):Ee(t,r)}function Ee(t,e){return j(t.path.head,E.Strict,e,t.path.tail)}function j(t,e,r,n){let s,a=l.GetSymbol;return t.kind===tt?(a=e==="Strict"?l.GetStrictKeyword:e==="AppendBare"||e==="AppendInvoke"?l.GetFreeAsComponentOrHelperHead:e==="TrustedAppendBare"||e==="TrustedAppendInvoke"||e==="AttrValueBare"||e==="AttrValueInvoke"||e==="SubExpression"?l.GetFreeAsHelperHead:function(i){switch(i){case E.Strict:return l.GetStrictKeyword;case E.ResolveAsComponentOrHelperHead:return l.GetFreeAsComponentOrHelperHead;case E.ResolveAsHelperHead:return l.GetFreeAsHelperHead;case E.ResolveAsModifierHead:return l.GetFreeAsModifierHead;case E.ResolveAsComponentHead:return l.GetFreeAsComponentHead;default:return}}(e),s=r.freeVar(t.name)):(a=l.GetSymbol,s=function(i,o,u){switch(i){case"Arg":return o.arg(u);case Y:return o.block(u);case et:return o.local(u);case rt:return o.this();default:return}}(t.kind,r,t.name)),n===void 0||n.length===0?[a,s]:[a,s,n]}function X(t,e){return t!==null&&N(t)?t.map(r=>M(r,"Strict",e)):null}function Zt(t,e){return t.map(r=>M(r,"AttrValue",e))}function ke(t,e){if(t===null)return null;let r=[[],[]];for(const[n,s]of Object.entries(t))r[0].push(n),r[1].push(M(s,"Strict",e));return r}function Z(t,e,r=[]){return[Wt(t,e),r]}class Qt extends p("Template").fields(){}class er extends p("InElement").fields(){}class ut extends p("Not").fields(){}class Ge extends p("If").fields(){}class tr extends p("IfInline").fields(){}class rr extends p("Each").fields(){}class nr extends p("Let").fields(){}class sr extends p("WithDynamicVars").fields(){}class ar extends p("GetDynamicVar").fields(){}class lr extends p("Log").fields(){}class pt extends p("InvokeComponent").fields(){}class ir extends p("NamedBlocks").fields(){}class or extends p("NamedBlock").fields(){}class cr extends p("AppendTrustedHTML").fields(){}class Q extends p("AppendTextNode").fields(){}class ur extends p("AppendComment").fields(){}class pr extends p("Component").fields(){}class mr extends p("StaticAttr").fields(){}class dr extends p("DynamicAttr").fields(){}class hr extends p("SimpleElement").fields(){}class fr extends p("ElementParameters").fields(){}class yr extends p("Yield").fields(){}class kr extends p("Debugger").fields(){}class mt extends p("CallExpression").fields(){}class gr extends p("Modifier").fields(){}class vr extends p("InvokeBlock").fields(){}class br extends p("SplatAttr").fields(){}class wr extends p("PathExpression").fields(){}class Ar extends p("Missing").fields(){}class xr extends p("InterpolateExpression").fields(){}class Er extends p("HasBlock").fields(){}class Sr extends p("HasBlockParams").fields(){}class Cr extends p("Curry").fields(){}class Or extends p("Positional").fields(){}class dt extends p("NamedArguments").fields(){}class ht extends p("NamedArgument").fields(){}class Br extends p("Args").fields(){}class Nr extends p("Tail").fields(){}class Se{constructor(e){this.list=e}toArray(){return this.list}map(e){let r=nt(this.list,e);return new Se(r)}filter(e){let r=[];for(let n of this.list)e(n)&&r.push(n);return W(r)}toPresentArray(){return this.list}into({ifPresent:e}){return e(this)}}class ee{map(e){return new ee}filter(e){return new ee}toArray(){return this.list}toPresentArray(){return null}into({ifEmpty:e}){return e()}constructor(){this.list=[]}}function W(t){return N(t)?new Se(t):new ee}class Ce{static all(...e){let r=[];for(let n of e){if(n.isErr)return n.cast();r.push(n.value)}return c(r)}}const v=Ce;class Tr extends Ce{constructor(e){super(),this.value=e,this.isOk=!0,this.isErr=!1}expect(e){return this.value}ifOk(e){return e(this.value),this}andThen(e){return e(this.value)}mapOk(e){return c(e(this.value))}ifErr(e){return this}mapErr(e){return this}}class ft extends Ce{constructor(e){super(),this.reason=e,this.isOk=!1,this.isErr=!0}expect(e){throw new Error(e||"expected an Ok, got Err")}andThen(e){return this.cast()}mapOk(e){return this.cast()}ifOk(e){return this}mapErr(e){return m(e(this.reason))}ifErr(e){return e(this.reason),this}cast(){return this}}function c(t){return new Tr(t)}function m(t){return new ft(t)}class P{constructor(e=[]){this.items=e}add(e){this.items.push(e)}toArray(){let e=this.items.filter(r=>r instanceof ft)[0];return e!==void 0?e.cast():c(this.items.map(r=>r.value))}toOptionalList(){return this.toArray().mapOk(e=>W(e))}}function te(t){return t.type==="Path"&&t.ref.type==="Free"&&t.ref.name in ze?new B.CallExpression({callee:t,args:B.Args.empty(t.loc),loc:t.loc}):t}const f=new class{visit(t,e){switch(t.type){case"Literal":return c(this.Literal(t));case"Keyword":return c(this.Keyword(t));case"Interpolate":return this.Interpolate(t,e);case"Path":return this.PathExpression(t);case"Call":{let r=Wr.translate(t,e);return r!==null?r:this.CallExpression(t,e)}}}visitList(t,e){return new P(t.map(r=>f.visit(r,e))).toOptionalList()}PathExpression(t){let e=this.VariableReference(t.ref),{tail:r}=t;if(N(r)){let s=r[0].loc.extend((n=r,n.length===0?void 0:n[n.length-1]).loc);return c(new wr({loc:t.loc,head:e,tail:new Nr({loc:s,members:r})}))}return c(e);var n}VariableReference(t){return t}Literal(t){return t}Keyword(t){return t}Interpolate(t,e){let r=t.parts.map(te);return f.visitList(r,e).mapOk(n=>new xr({loc:t.loc,parts:n}))}CallExpression(t,e){if(t.callee.type==="Call")throw new Error("unimplemented: subexpression at the head of a subexpression");return v.all(f.visit(t.callee,e),f.Args(t.args,e)).mapOk(([r,n])=>new mt({loc:t.loc,callee:r,args:n}))}Args({positional:t,named:e,loc:r},n){return v.all(this.Positional(t,n),this.NamedArguments(e,n)).mapOk(([s,a])=>new Br({loc:r,positional:s,named:a}))}Positional(t,e){return f.visitList(t.exprs,e).mapOk(r=>new Or({loc:t.loc,list:r}))}NamedArguments(t,e){let r=t.entries.map(n=>{let s=te(n.value);return f.visit(s,e).mapOk(a=>new ht({loc:n.loc,key:n.name,value:a}))});return new P(r).toOptionalList().mapOk(n=>new dt({loc:t.loc,entries:n}))}};class Ir{constructor(e,r,n){this.keyword=e,this.delegate=n;let s=new Set;for(let a of Pr[r])s.add(a);this.types=s}match(e){if(!this.types.has(e.type))return!1;let r=re(e);return r!==null&&r.type==="Path"&&r.ref.type==="Free"&&r.ref.name===this.keyword}translate(e,r){if(this.match(e)){let n=re(e);return n!==null&&n.type==="Path"&&n.tail.length>0?m(h(`The \`${this.keyword}\` keyword was used incorrectly. It was used as \`${n.loc.asString()}\`, but it cannot be used with additional path segments. 

Error caused by`,e.loc)):this.delegate.assert(e,r).andThen(s=>this.delegate.translate({node:e,state:r},s))}return null}}const Pr={Call:["Call"],Block:["InvokeBlock"],Append:["AppendContent"],Modifier:["ElementModifier"]};function re(t){switch(t.type){case"Path":return t;case"AppendContent":return re(t.value);case"Call":case"InvokeBlock":case"ElementModifier":return t.callee;default:return null}}class Hr{constructor(e){this._keywords=[],this._type=e}kw(e,r){return this._keywords.push(new Ir(e,this._type,r)),this}translate(e,r){for(let s of this._keywords){let a=s.translate(e,r);if(a!==null)return a}let n=re(e);if(n&&n.type==="Path"&&n.ref.type==="Free"&&Lt(n.ref.name)){let{name:s}=n.ref,a=this._type,i=ze[s];if(!i.includes(a))return m(h(`The \`${s}\` keyword was used incorrectly. It was used as ${Lr[a]}, but its valid usages are:

${function(o,u){return u.map(y=>{switch(y){case"Append":return`- As an append statement, as in: {{${o}}}`;case"Block":return`- As a block statement, as in: {{#${o}}}{{/${o}}}`;case"Call":return`- As an expression, as in: (${o})`;case"Modifier":return`- As a modifier, as in: <div {{${o}}}></div>`;default:return}}).join(`

`)}(s,i)}

Error caused by`,e.loc))}return null}}const Lr={Append:"an append statement",Block:"a block statement",Call:"a call expression",Modifier:"a modifier"};function ce(t){return new Hr(t)}function G({assert:t,translate:e}){return{assert:t,translate:({node:r,state:n},s)=>e({node:r,state:n},s).mapOk(a=>new Q({text:a,loc:r.loc}))}}const Mr={[Dt]:"component",[Ft]:"helper",[Vt]:"modifier"};function ne(t){return(e,r)=>{let n=Mr[t],s=t===0,{args:a}=e,i=a.nth(0);if(i===null)return m(h(`(${n}) requires a ${n} definition or identifier as its first positional parameter, did not receive any parameters.`,a.loc));if(i.type==="Literal"){if(s&&r.isStrict)return m(h(`(${n}) cannot resolve string values in strict mode templates`,e.loc));if(!s)return m(h(`(${n}) cannot resolve string values, you must pass a ${n} definition directly`,e.loc))}return a=new B.Args({positional:new B.PositionalArguments({exprs:a.positional.exprs.slice(1),loc:a.positional.loc}),named:a.named,loc:a.loc}),c({definition:i,args:a})}}function Gr(t){return({node:e,state:r},{definition:n,args:s})=>{let a=f.visit(n,r),i=f.Args(s,r);return v.all(a,i).mapOk(([o,u])=>new Cr({loc:e.loc,curriedType:t,definition:o,args:u}))}}function de(t){return{assert:ne(t),translate:Gr(t)}}const yt={assert:function(t){let e=t.type==="AppendContent"?t.value:t,r=e.type==="Call"?e.args.named:null,n=e.type==="Call"?e.args.positional:null;if(r&&!r.isEmpty())return m(h("(-get-dynamic-vars) does not take any named arguments",t.loc));let s=n?.nth(0);return s?n&&n.size>1?m(h("(-get-dynamic-vars) only receives one positional arg",t.loc)):c(s):m(h("(-get-dynamic-vars) requires a var name to get",t.loc))},translate:function({node:t,state:e},r){return f.visit(r,e).mapOk(n=>new ar({name:n,loc:t.loc}))}};function Dr(t){return e=>{let r=e.type==="AppendContent"?e.value:e,n=r.type==="Call"?r.args.named:null,s=r.type==="Call"?r.args.positional:null;if(n&&!n.isEmpty())return m(h(`(${t}) does not take any named arguments`,r.loc));if(!s||s.isEmpty())return c(Mt.synthetic("default"));if(s.exprs.length===1){let a=s.exprs[0];return B.isLiteral(a,"string")?c(a.toSlice()):m(h(`(${t}) can only receive a string literal as its first argument`,r.loc))}return m(h(`(${t}) only takes a single positional argument`,r.loc))}}function Fr(t){return({node:e,state:{scope:r}},n)=>c(t==="has-block"?new Er({loc:e.loc,target:n,symbol:r.allocateBlock(n.chars)}):new Sr({loc:e.loc,target:n,symbol:r.allocateBlock(n.chars)}))}function se(t){return{assert:Dr(t),translate:Fr(t)}}function Vr(t){return e=>{let r=t==="unless",n=e.type==="AppendContent"?e.value:e,s=n.type==="Call"?n.args.named:null,a=n.type==="Call"?n.args.positional:null;if(s&&!s.isEmpty())return m(h(`(${t}) cannot receive named parameters, received ${s.entries.map(y=>y.name.chars).join(", ")}`,e.loc));let i=a?.nth(0);if(!a||!i)return m(h(`When used inline, (${t}) requires at least two parameters 1. the condition that determines the state of the (${t}), and 2. the value to return if the condition is ${r?"false":"true"}. Did not receive any parameters`,e.loc));let o=a.nth(1),u=a.nth(2);return o===null?m(h(`When used inline, (${t}) requires at least two parameters 1. the condition that determines the state of the (${t}), and 2. the value to return if the condition is ${r?"false":"true"}. Received only one parameter, the condition`,e.loc)):a.size>3?m(h(`When used inline, (${t}) can receive a maximum of three positional parameters 1. the condition that determines the state of the (${t}), 2. the value to return if the condition is ${r?"false":"true"}, and 3. the value to return if the condition is ${r?"true":"false"}. Received ${a.size} parameters`,e.loc)):c({condition:i,truthy:o,falsy:u})}}function $r(t){let e=t==="unless";return({node:r,state:n},{condition:s,truthy:a,falsy:i})=>{let o=f.visit(s,n),u=f.visit(a,n),y=i?f.visit(i,n):c(null);return v.all(o,u,y).mapOk(([k,b,A])=>(e&&(k=new ut({value:k,loc:r.loc})),new tr({loc:r.loc,condition:k,truthy:b,falsy:A})))}}function ae(t){return{assert:Vr(t),translate:$r(t)}}const kt={assert:function(t){let{args:{named:e,positional:r}}=t;return e.isEmpty()?c(r):m(h("(log) does not take any named arguments",t.loc))},translate:function({node:t,state:e},r){return f.Positional(r,e).mapOk(n=>new lr({positional:n,loc:t.loc}))}},_r=ce("Append").kw("has-block",G(se("has-block"))).kw("has-block-params",G(se("has-block-params"))).kw("-get-dynamic-var",G(yt)).kw("log",G(kt)).kw("if",G(ae("if"))).kw("unless",G(ae("unless"))).kw("yield",{assert(t){let{args:e}=t;if(e.named.isEmpty())return c({target:U.SourceSpan.synthetic("default").toSlice(),positional:e.positional});{let r=e.named.get("to");return e.named.size>1||r===null?m(h("yield only takes a single named argument: 'to'",e.named.loc)):B.isLiteral(r,"string")?c({target:r.toSlice(),positional:e.positional}):m(h("you can only yield to a literal string value",r.loc))}},translate:({node:t,state:e},{target:r,positional:n})=>f.Positional(n,e).mapOk(s=>new yr({loc:t.loc,target:r,to:e.scope.allocateBlock(r.chars),positional:s}))}).kw("debugger",{assert(t){let{args:e}=t,{positional:r}=e;return e.isEmpty()?c(void 0):r.isEmpty()?m(h("debugger does not take any named arguments",t.loc)):m(h("debugger does not take any positional arguments",t.loc))},translate:({node:t,state:{scope:e}})=>c(new kr({loc:t.loc,scope:e}))}).kw("component",{assert:ne(0),translate({node:t,state:e},{definition:r,args:n}){let s=f.visit(r,e),a=f.Args(n,e);return v.all(s,a).mapOk(([i,o])=>new pt({loc:t.loc,definition:i,args:o,blocks:null}))}}).kw("helper",{assert:ne(1),translate({node:t,state:e},{definition:r,args:n}){let s=f.visit(r,e),a=f.Args(n,e);return v.all(s,a).mapOk(([i,o])=>{let u=new mt({callee:i,args:o,loc:t.loc});return new Q({loc:t.loc,text:u})})}}),jr=ce("Block").kw("in-element",{assert(t){let{args:e}=t,r=e.get("guid");if(r)return m(h("Cannot pass `guid` to `{{#in-element}}`",r.loc));let n=e.get("insertBefore"),s=e.nth(0);return s===null?m(h("{{#in-element}} requires a target element as its first positional parameter",e.loc)):c({insertBefore:n,destination:s})},translate({node:t,state:e},{insertBefore:r,destination:n}){let s=t.blocks.get("default"),a=w.NamedBlock(s,e),i=f.visit(n,e);return v.all(a,i).andThen(([o,u])=>r?f.visit(r,e).mapOk(y=>({body:o,destination:u,insertBefore:y})):c({body:o,destination:u,insertBefore:new Ar({loc:t.callee.loc.collapse("end")})})).mapOk(({body:o,destination:u,insertBefore:y})=>new er({loc:t.loc,block:o,insertBefore:y,guid:e.generateUniqueCursor(),destination:u}))}}).kw("if",{assert(t){let{args:e}=t;if(!e.named.isEmpty())return m(h(`{{#if}} cannot receive named parameters, received ${e.named.entries.map(n=>n.name.chars).join(", ")}`,t.loc));if(e.positional.size>1)return m(h(`{{#if}} can only receive one positional parameter in block form, the conditional value. Received ${e.positional.size} parameters`,t.loc));let r=e.nth(0);return r===null?m(h("{{#if}} requires a condition as its first positional parameter, did not receive any parameters",t.loc)):c({condition:r})},translate({node:t,state:e},{condition:r}){let n=t.blocks.get("default"),s=t.blocks.get("else"),a=f.visit(r,e),i=w.NamedBlock(n,e),o=s?w.NamedBlock(s,e):c(null);return v.all(a,i,o).mapOk(([u,y,k])=>new Ge({loc:t.loc,condition:u,block:y,inverse:k}))}}).kw("unless",{assert(t){let{args:e}=t;if(!e.named.isEmpty())return m(h(`{{#unless}} cannot receive named parameters, received ${e.named.entries.map(n=>n.name.chars).join(", ")}`,t.loc));if(e.positional.size>1)return m(h(`{{#unless}} can only receive one positional parameter in block form, the conditional value. Received ${e.positional.size} parameters`,t.loc));let r=e.nth(0);return r===null?m(h("{{#unless}} requires a condition as its first positional parameter, did not receive any parameters",t.loc)):c({condition:r})},translate({node:t,state:e},{condition:r}){let n=t.blocks.get("default"),s=t.blocks.get("else"),a=f.visit(r,e),i=w.NamedBlock(n,e),o=s?w.NamedBlock(s,e):c(null);return v.all(a,i,o).mapOk(([u,y,k])=>new Ge({loc:t.loc,condition:new ut({value:u,loc:t.loc}),block:y,inverse:k}))}}).kw("each",{assert(t){let{args:e}=t;if(!e.named.entries.every(s=>s.name.chars==="key"))return m(h(`{{#each}} can only receive the 'key' named parameter, received ${e.named.entries.filter(s=>s.name.chars!=="key").map(s=>s.name.chars).join(", ")}`,e.named.loc));if(e.positional.size>1)return m(h(`{{#each}} can only receive one positional parameter, the collection being iterated. Received ${e.positional.size} parameters`,e.positional.loc));let r=e.nth(0),n=e.get("key");return r===null?m(h("{{#each}} requires an iterable value to be passed as its first positional parameter, did not receive any parameters",e.loc)):c({value:r,key:n})},translate({node:t,state:e},{value:r,key:n}){let s=t.blocks.get("default"),a=t.blocks.get("else"),i=f.visit(r,e),o=n?f.visit(n,e):c(null),u=w.NamedBlock(s,e),y=a?w.NamedBlock(a,e):c(null);return v.all(i,o,u,y).mapOk(([k,b,A,x])=>new rr({loc:t.loc,value:k,key:b,block:A,inverse:x}))}}).kw("let",{assert(t){let{args:e}=t;return e.named.isEmpty()?e.positional.size===0?m(h("{{#let}} requires at least one value as its first positional parameter, did not receive any parameters",e.positional.loc)):t.blocks.get("else")?m(h("{{#let}} cannot receive an {{else}} block",e.positional.loc)):c({positional:e.positional}):m(h(`{{#let}} cannot receive named parameters, received ${e.named.entries.map(r=>r.name.chars).join(", ")}`,e.named.loc))},translate({node:t,state:e},{positional:r}){let n=t.blocks.get("default"),s=f.Positional(r,e),a=w.NamedBlock(n,e);return v.all(s,a).mapOk(([i,o])=>new nr({loc:t.loc,positional:i,block:o}))}}).kw("-with-dynamic-vars",{assert:t=>c({named:t.args.named}),translate({node:t,state:e},{named:r}){let n=t.blocks.get("default"),s=f.NamedArguments(r,e),a=w.NamedBlock(n,e);return v.all(s,a).mapOk(([i,o])=>new sr({loc:t.loc,named:i,block:o}))}}).kw("component",{assert:ne(0),translate({node:t,state:e},{definition:r,args:n}){let s=f.visit(r,e),a=f.Args(n,e),i=w.NamedBlocks(t.blocks,e);return v.all(s,a,i).mapOk(([o,u,y])=>new pt({loc:t.loc,definition:o,args:u,blocks:y}))}}),Wr=ce("Call").kw("has-block",se("has-block")).kw("has-block-params",se("has-block-params")).kw("-get-dynamic-var",yt).kw("log",kt).kw("if",ae("if")).kw("unless",ae("unless")).kw("component",de(0)).kw("helper",de(1)).kw("modifier",de(2)),zr=ce("Modifier"),I="http://www.w3.org/1999/xlink",he="http://www.w3.org/XML/1998/namespace",De="http://www.w3.org/2000/xmlns/",qr={"xlink:actuate":I,"xlink:arcrole":I,"xlink:href":I,"xlink:role":I,"xlink:show":I,"xlink:title":I,"xlink:type":I,"xml:base":he,"xml:lang":he,"xml:space":he,xmlns:De,"xmlns:xlink":De},Rr={div:R.div,span:R.span,p:R.p,a:R.a},Jr=["div","span","p","a"];function Fe(t){return typeof t=="string"?t:Jr[t]}const Kr={class:T.class,id:T.id,value:T.value,name:T.name,type:T.type,style:T.style,href:T.href},Ur=["class","id","value","name","type","style","href"];function gt(t){return Kr[t]??t}function D(t){return typeof t=="string"?t:Ur[t]}class Ve{constructor(e,r,n){this.element=e,this.state=n,this.delegate=r}toStatement(){return this.prepare().andThen(e=>this.delegate.toStatement(this,e))}attr(e){let r=e.name,n=e.value,s=(a=r.chars,qr[a]||void 0);var a;return B.isLiteral(n,"string")?c(new mr({loc:e.loc,name:r,value:n.toSlice(),namespace:s,kind:{component:this.delegate.dynamicFeatures}})):f.visit(te(n),this.state).mapOk(i=>{let o=e.trusting;return new dr({loc:e.loc,name:r,value:i,namespace:s,kind:{trusting:o,component:this.delegate.dynamicFeatures}})})}modifier(e){let r=zr.translate(e,this.state);if(r!==null)return r;let n=f.visit(e.callee,this.state),s=f.Args(e.args,this.state);return v.all(n,s).mapOk(([a,i])=>new gr({loc:e.loc,callee:a,args:i}))}attrs(){let e=new P,r=new P,n=null,s=this.element.attrs.filter(a=>a.type==="SplatAttr").length===0;for(let a of this.element.attrs)a.type==="SplatAttr"?e.add(c(new br({loc:a.loc,symbol:this.state.scope.allocateBlock("attrs")}))):a.name.chars==="type"&&s?n=a:e.add(this.attr(a));for(let a of this.element.componentArgs)r.add(this.delegate.arg(a,this));return n&&e.add(this.attr(n)),v.all(r.toArray(),e.toArray()).mapOk(([a,i])=>({attrs:i,args:new dt({loc:Be(a,U.SourceSpan.NON_EXISTENT),entries:W(a)})}))}prepare(){let e=this.attrs(),r=new P(this.element.modifiers.map(n=>this.modifier(n))).toArray();return v.all(e,r).mapOk(([n,s])=>{let{attrs:a,args:i}=n,o=[...a,...s];return{args:i,params:new fr({loc:Be(o,U.SourceSpan.NON_EXISTENT),body:W(o)})}})}}class Yr{constructor(e,r){this.tag=e,this.element=r,this.dynamicFeatures=!0}arg(e,{state:r}){let n=e.name;return f.visit(te(e.value),r).mapOk(s=>new ht({loc:e.loc,key:n,value:s}))}toStatement(e,{args:r,params:n}){let{element:s,state:a}=e;return this.blocks(a).mapOk(i=>new pr({loc:s.loc,tag:this.tag,params:n,args:r,blocks:i}))}blocks(e){return w.NamedBlocks(this.element.blocks,e)}}class Xr{constructor(e,r,n){this.tag=e,this.element=r,this.dynamicFeatures=n,this.isComponent=!1}arg(e){return m(h(`${e.name.chars} is not a valid attribute name. @arguments are only allowed on components, but the tag for this element (\`${this.tag.chars}\`) is a regular, non-component HTML element.`,e.loc))}toStatement(e,{params:r}){let{state:n,element:s}=e;return w.visitList(this.element.body,n).mapOk(a=>new hr({loc:s.loc,tag:this.tag,params:r,body:a.toArray(),dynamicFeatures:this.dynamicFeatures}))}}const w=new class{visitList(t,e){return new P(t.map(r=>w.visit(r,e))).toOptionalList().mapOk(r=>r.filter(n=>n!==null))}visit(t,e){switch(t.type){case"GlimmerComment":return c(null);case"AppendContent":return this.AppendContent(t,e);case"HtmlText":return c(this.TextNode(t));case"HtmlComment":return c(this.HtmlComment(t));case"InvokeBlock":return this.InvokeBlock(t,e);case"InvokeComponent":return this.Component(t,e);case"SimpleElement":return this.SimpleElement(t,e)}}InvokeBlock(t,e){let r=jr.translate(t,e);if(r!==null)return r;let n=f.visit(t.callee,e),s=f.Args(t.args,e);return v.all(n,s).andThen(([a,i])=>this.NamedBlocks(t.blocks,e).mapOk(o=>new vr({loc:t.loc,head:a,args:i,blocks:o})))}NamedBlocks(t,e){return new P(t.blocks.map(r=>this.NamedBlock(r,e))).toArray().mapOk(r=>new ir({loc:t.loc,blocks:W(r)}))}NamedBlock(t,e){return e.visitBlock(t.block).mapOk(r=>new or({loc:t.loc,name:t.name,body:r.toArray(),scope:t.block.scope}))}SimpleElement(t,e){return new Ve(t,new Xr(t.tag,t,function({attrs:r,modifiers:n}){return n.length>0||!!r.filter(s=>s.type==="SplatAttr")[0]}(t)),e).toStatement()}Component(t,e){return f.visit(t.callee,e).andThen(r=>new Ve(t,new Yr(r,t),e).toStatement())}AppendContent(t,e){let r=_r.translate(t,e);return r!==null?r:f.visit(t.value,e).mapOk(n=>t.trusting?new cr({loc:t.loc,html:n}):new Q({loc:t.loc,text:n}))}TextNode(t){return new Q({loc:t.loc,text:new B.LiteralExpression({loc:t.loc,value:t.chars})})}HtmlComment(t){return new ur({loc:t.loc,value:t.text})}};class Zr{constructor(e,r){this.isStrict=r,this._cursorCount=0,this._currentScope=e}generateUniqueCursor(){return`%cursor:${this._cursorCount++}%`}get scope(){return this._currentScope}visitBlock(e){let r=this._currentScope;this._currentScope=e.scope;try{return w.visitList(e.body,this)}finally{this._currentScope=r}}}const J="component",K="helper",$e="modifier";class Qr{static validate(e){return new this(e).validate()}constructor(e){this.template=e}validate(){return this.Statements(this.template.body).mapOk(()=>this.template)}Statements(e){let r=c(null);for(let n of e)r=r.andThen(()=>this.Statement(n));return r}NamedBlocks({blocks:e}){let r=c(null);for(let n of e.toArray())r=r.andThen(()=>this.NamedBlock(n));return r}NamedBlock(e){return this.Statements(e.body)}Statement(e){switch(e.type){case"InElement":return this.InElement(e);case"Debugger":case"AppendComment":return c(null);case"Yield":return this.Yield(e);case"AppendTrustedHTML":return this.AppendTrustedHTML(e);case"AppendTextNode":return this.AppendTextNode(e);case"Component":return this.Component(e);case"SimpleElement":return this.SimpleElement(e);case"InvokeBlock":return this.InvokeBlock(e);case"If":return this.If(e);case"Each":return this.Each(e);case"Let":return this.Let(e);case"WithDynamicVars":return this.WithDynamicVars(e);case"InvokeComponent":return this.InvokeComponent(e)}}Expressions(e){let r=c(null);for(let n of e)r=r.andThen(()=>this.Expression(n));return r}Expression(e,r=e,n){switch(e.type){case"Literal":case"Keyword":case"Missing":case"This":case"Arg":case"Local":case"HasBlock":case"HasBlockParams":case"GetDynamicVar":return c(null);case"PathExpression":return this.Expression(e.head,r,n);case"Free":return this.errorFor(e.name,r,n);case"InterpolateExpression":return this.InterpolateExpression(e,r,n);case"CallExpression":return this.CallExpression(e,r,n??K);case"Not":return this.Expression(e.value,r,n);case"IfInline":return this.IfInline(e);case"Curry":return this.Curry(e);case"Log":return this.Log(e)}}Args(e){return this.Positional(e.positional).andThen(()=>this.NamedArguments(e.named))}Positional(e,r){let n=c(null),s=e.list.toArray();return n=s.length===1?this.Expression(s[0],r):this.Expressions(s),n}NamedArguments({entries:e}){let r=c(null);for(let n of e.toArray())r=r.andThen(()=>this.NamedArgument(n));return r}NamedArgument(e){return e.value.type==="CallExpression"?this.Expression(e.value,e,K):this.Expression(e.value,e)}ElementParameters({body:e}){let r=c(null);for(let n of e.toArray())r=r.andThen(()=>this.ElementParameter(n));return r}ElementParameter(e){switch(e.type){case"StaticAttr":case"SplatAttr":return c(null);case"DynamicAttr":return this.DynamicAttr(e);case"Modifier":return this.Modifier(e)}}DynamicAttr(e){return e.value.type==="CallExpression"?this.Expression(e.value,e,K):this.Expression(e.value,e)}Modifier(e){return this.Expression(e.callee,e,$e).andThen(()=>this.Args(e.args))}InElement(e){return this.Expression(e.destination).andThen(()=>this.Expression(e.insertBefore)).andThen(()=>this.NamedBlock(e.block))}Yield(e){return this.Positional(e.positional,e)}AppendTrustedHTML(e){return this.Expression(e.html,e)}AppendTextNode(e){return e.text.type==="CallExpression"?this.Expression(e.text,e,"component or helper"):this.Expression(e.text,e)}Component(e){return this.Expression(e.tag,e,J).andThen(()=>this.ElementParameters(e.params)).andThen(()=>this.NamedArguments(e.args)).andThen(()=>this.NamedBlocks(e.blocks))}SimpleElement(e){return this.ElementParameters(e.params).andThen(()=>this.Statements(e.body))}InvokeBlock(e){return this.Expression(e.head,e.head,J).andThen(()=>this.Args(e.args)).andThen(()=>this.NamedBlocks(e.blocks))}If(e){return this.Expression(e.condition,e).andThen(()=>this.NamedBlock(e.block)).andThen(()=>e.inverse?this.NamedBlock(e.inverse):c(null))}Each(e){return this.Expression(e.value,e).andThen(()=>e.key?this.Expression(e.key,e):c(null)).andThen(()=>this.NamedBlock(e.block)).andThen(()=>e.inverse?this.NamedBlock(e.inverse):c(null))}Let(e){return this.Positional(e.positional).andThen(()=>this.NamedBlock(e.block))}WithDynamicVars(e){return this.NamedArguments(e.named).andThen(()=>this.NamedBlock(e.block))}InvokeComponent(e){return this.Expression(e.definition,e,J).andThen(()=>this.Args(e.args)).andThen(()=>e.blocks?this.NamedBlocks(e.blocks):c(null))}InterpolateExpression(e,r,n){let s=e.parts.toArray();return s.length===1?this.Expression(s[0],r,n):this.Expressions(s)}CallExpression(e,r,n){return this.Expression(e.callee,r,n).andThen(()=>this.Args(e.args))}IfInline(e){return this.Expression(e.condition).andThen(()=>this.Expression(e.truthy)).andThen(()=>e.falsy?this.Expression(e.falsy):c(null))}Curry(e){let r;return r=e.curriedType===0?J:e.curriedType===1?K:$e,this.Expression(e.definition,e,r).andThen(()=>this.Args(e.args))}Log(e){return this.Positional(e.positional,e)}errorFor(e,r,n="value"){return m(h(`Attempted to resolve a ${n} in a strict mode template, but that value was not in scope: ${e}`,Ht(r)))}}class en{constructor([e,r,n]){this.upvars=n,this.symbols=r}format(e){let r=[];for(let n of e[0])r.push(this.formatOpcode(n));return r}formatOpcode(e){if(!Array.isArray(e))return e;switch(e[0]){case l.Append:return["append",this.formatOpcode(e[1])];case l.TrustingAppend:return["trusting-append",this.formatOpcode(e[1])];case l.Block:return["block",this.formatOpcode(e[1]),this.formatParams(e[2]),this.formatHash(e[3]),this.formatBlocks(e[4])];case l.InElement:return["in-element",e[1],this.formatOpcode(e[2]),e[3]?this.formatOpcode(e[3]):void 0];case l.OpenElement:return["open-element",Fe(e[1])];case l.OpenElementWithSplat:return["open-element-with-splat",Fe(e[1])];case l.CloseElement:return["close-element"];case l.FlushElement:return["flush-element"];case l.StaticAttr:return["static-attr",D(e[1]),e[2],e[3]];case l.StaticComponentAttr:return["static-component-attr",D(e[1]),e[2],e[3]];case l.DynamicAttr:return["dynamic-attr",D(e[1]),this.formatOpcode(e[2]),e[3]];case l.ComponentAttr:return["component-attr",D(e[1]),this.formatOpcode(e[2]),e[3]];case l.AttrSplat:return["attr-splat"];case l.Yield:return["yield",e[1],this.formatParams(e[2])];case l.DynamicArg:return["dynamic-arg",e[1],this.formatOpcode(e[2])];case l.StaticArg:return["static-arg",e[1],this.formatOpcode(e[2])];case l.TrustingDynamicAttr:return["trusting-dynamic-attr",D(e[1]),this.formatOpcode(e[2]),e[3]];case l.TrustingComponentAttr:return["trusting-component-attr",D(e[1]),this.formatOpcode(e[2]),e[3]];case l.Debugger:return["debugger",e[1]];case l.Comment:return["comment",e[1]];case l.Modifier:return["modifier",this.formatOpcode(e[1]),this.formatParams(e[2]),this.formatHash(e[3])];case l.Component:return["component",this.formatOpcode(e[1]),this.formatElementParams(e[2]),this.formatHash(e[3]),this.formatBlocks(e[4])];case l.HasBlock:return["has-block",this.formatOpcode(e[1])];case l.HasBlockParams:return["has-block-params",this.formatOpcode(e[1])];case l.Curry:return["curry",this.formatOpcode(e[1]),this.formatCurryType(e[2]),this.formatParams(e[3]),this.formatHash(e[4])];case l.Undefined:return["undefined"];case l.Call:return["call",this.formatOpcode(e[1]),this.formatParams(e[2]),this.formatHash(e[3])];case l.Concat:return["concat",this.formatParams(e[1])];case l.GetStrictKeyword:return["get-strict-free",this.upvars[e[1]]];case l.GetFreeAsComponentOrHelperHead:return["GetFreeAsComponentOrHelperHead",this.upvars[e[1]],e[2]];case l.GetFreeAsHelperHead:return["GetFreeAsHelperHead",this.upvars[e[1]],e[2]];case l.GetFreeAsComponentHead:return["GetFreeAsComponentHead",this.upvars[e[1]],e[2]];case l.GetFreeAsModifierHead:return["GetFreeAsModifierHead",this.upvars[e[1]],e[2]];case l.GetSymbol:return e[1]===0?["get-symbol","this",e[2]]:["get-symbol",this.symbols[e[1]-1],e[2]];case l.GetLexicalSymbol:return["get-template-symbol",e[1],e[2]];case l.If:return["if",this.formatOpcode(e[1]),this.formatBlock(e[2]),e[3]?this.formatBlock(e[3]):null];case l.IfInline:return["if-inline"];case l.Not:return["not"];case l.Each:return["each",this.formatOpcode(e[1]),e[2]?this.formatOpcode(e[2]):null,this.formatBlock(e[3]),e[4]?this.formatBlock(e[4]):null];case l.Let:return["let",this.formatParams(e[1]),this.formatBlock(e[2])];case l.Log:return["log",this.formatParams(e[1])];case l.WithDynamicVars:return["-with-dynamic-vars",this.formatHash(e[1]),this.formatBlock(e[2])];case l.GetDynamicVar:return["-get-dynamic-vars",this.formatOpcode(e[1])];case l.InvokeComponent:return["component",this.formatOpcode(e[1]),this.formatParams(e[2]),this.formatHash(e[3]),this.formatBlocks(e[4])]}}formatCurryType(e){switch(e){case 0:return"component";case 1:return"helper";case 2:return"modifier"}}formatElementParams(e){return e===null?null:e.map(r=>this.formatOpcode(r))}formatParams(e){return e===null?null:e.map(r=>this.formatOpcode(r))}formatHash(e){return e===null?null:e[0].reduce((r,n,s)=>(r[n]=this.formatOpcode(e[1][s]),r),H())}formatBlocks(e){return e===null?null:e[0].reduce((r,n,s)=>(r[n]=this.formatBlock(e[1][s]),r),H())}formatBlock(e){return{statements:e[0].map(r=>this.formatOpcode(r)),parameters:e[1]}}}const d=new class{expr(t){switch(t.type){case"Missing":return;case"Literal":return this.Literal(t);case"Keyword":return this.Keyword(t);case"CallExpression":return this.CallExpression(t);case"PathExpression":return this.PathExpression(t);case"Arg":return[l.GetSymbol,t.symbol];case"Local":return this.Local(t);case"This":return[l.GetSymbol,0];case"Free":return[t.resolution.resolution(),t.symbol];case"HasBlock":return this.HasBlock(t);case"HasBlockParams":return this.HasBlockParams(t);case"Curry":return this.Curry(t);case"Not":return this.Not(t);case"IfInline":return this.IfInline(t);case"InterpolateExpression":return this.InterpolateExpression(t);case"GetDynamicVar":return this.GetDynamicVar(t);case"Log":return this.Log(t)}}Literal({value:t}){return t===void 0?[l.Undefined]:t}Missing(){}HasBlock({symbol:t}){return[l.HasBlock,[l.GetSymbol,t]]}HasBlockParams({symbol:t}){return[l.HasBlockParams,[l.GetSymbol,t]]}Curry({definition:t,curriedType:e,args:r}){return[l.Curry,d.expr(t),e,d.Positional(r.positional),d.NamedArguments(r.named)]}Local({isTemplateLocal:t,symbol:e}){return[t?l.GetLexicalSymbol:l.GetSymbol,e]}Keyword({symbol:t}){return[l.GetStrictKeyword,t]}PathExpression({head:t,tail:e}){let r=d.expr(t);return r[0],[...r,d.Tail(e)]}InterpolateExpression({parts:t}){return[l.Concat,t.map(e=>d.expr(e)).toArray()]}CallExpression({callee:t,args:e}){return[l.Call,d.expr(t),...d.Args(e)]}Tail({members:t}){return nt(t,e=>e.chars)}Args({positional:t,named:e}){return[this.Positional(t),this.NamedArguments(e)]}Positional({list:t}){return t.map(e=>d.expr(e)).toPresentArray()}NamedArgument({key:t,value:e}){return[t.chars,d.expr(e)]}NamedArguments({entries:t}){let e=t.toArray();if(N(e)){let r=[],n=[];for(let s of e){let[a,i]=d.NamedArgument(s);r.push(a),n.push(i)}return[r,n]}return null}Not({value:t}){return[l.Not,d.expr(t)]}IfInline({condition:t,truthy:e,falsy:r}){let n=[l.IfInline,d.expr(t),d.expr(e)];return r&&n.push(d.expr(r)),n}GetDynamicVar({name:t}){return[l.GetDynamicVar,d.expr(t)]}Log({positional:t}){return[l.Log,this.Positional(t)]}};class _e{constructor(e){this.statements=e}toArray(){return this.statements}}const g=new class{list(t){let e=[];for(let r of t){let n=g.content(r);n instanceof _e?e.push(...n.toArray()):e.push(n)}return e}content(t){return this.visitContent(t)}visitContent(t){switch(t.type){case"Debugger":return[l.Debugger,...t.scope.getDebugInfo(),{}];case"AppendComment":return this.AppendComment(t);case"AppendTextNode":return this.AppendTextNode(t);case"AppendTrustedHTML":return this.AppendTrustedHTML(t);case"Yield":return this.Yield(t);case"Component":return this.Component(t);case"SimpleElement":return this.SimpleElement(t);case"InElement":return this.InElement(t);case"InvokeBlock":return this.InvokeBlock(t);case"If":return this.If(t);case"Each":return this.Each(t);case"Let":return this.Let(t);case"WithDynamicVars":return this.WithDynamicVars(t);case"InvokeComponent":return this.InvokeComponent(t);default:return}}Yield({to:t,positional:e}){return[l.Yield,t,d.Positional(e)]}InElement({guid:t,insertBefore:e,destination:r,block:n}){let s=g.NamedBlock(n)[1],a=d.expr(r),i=d.expr(e);return i===void 0?[l.InElement,s,t,a]:[l.InElement,s,t,a,i]}InvokeBlock({head:t,args:e,blocks:r}){return[l.Block,d.expr(t),...d.Args(e),g.NamedBlocks(r)]}AppendTrustedHTML({html:t}){return[l.TrustingAppend,d.expr(t)]}AppendTextNode({text:t}){return[l.Append,d.expr(t)]}AppendComment({value:t}){return[l.Comment,t.chars]}SimpleElement({tag:t,params:e,body:r,dynamicFeatures:n}){let s=n?l.OpenElementWithSplat:l.OpenElement;return new _e([[s,(a=t.chars,Rr[a]??a)],...g.ElementParameters(e).toArray(),[l.FlushElement],...g.list(r),[l.CloseElement]]);var a}Component({tag:t,params:e,args:r,blocks:n}){let s=d.expr(t),a=g.ElementParameters(e),i=d.NamedArguments(r),o=g.NamedBlocks(n);return[l.Component,s,a.toPresentArray(),i,o]}ElementParameters({body:t}){return t.map(e=>g.ElementParameter(e))}ElementParameter(t){switch(t.type){case"SplatAttr":return[l.AttrSplat,t.symbol];case"DynamicAttr":return[(e=t.kind,e.component?e.trusting?l.TrustingComponentAttr:l.ComponentAttr:e.trusting?l.TrustingDynamicAttr:l.DynamicAttr),...rn(t)];case"StaticAttr":return[nn(t.kind),...tn(t)];case"Modifier":return[l.Modifier,d.expr(t.callee),...d.Args(t.args)]}var e}NamedBlocks({blocks:t}){let e=[],r=[];for(let n of t.toArray()){let[s,a]=g.NamedBlock(n);e.push(s),r.push(a)}return e.length>0?[e,r]:null}NamedBlock({name:t,body:e,scope:r}){let n=t.chars;return n==="inverse"&&(n="else"),[n,[g.list(e),r.slots]]}If({condition:t,block:e,inverse:r}){return[l.If,d.expr(t),g.NamedBlock(e)[1],r?g.NamedBlock(r)[1]:null]}Each({value:t,key:e,block:r,inverse:n}){return[l.Each,d.expr(t),e?d.expr(e):null,g.NamedBlock(r)[1],n?g.NamedBlock(n)[1]:null]}Let({positional:t,block:e}){return[l.Let,d.Positional(t),g.NamedBlock(e)[1]]}WithDynamicVars({named:t,block:e}){return[l.WithDynamicVars,d.NamedArguments(t),g.NamedBlock(e)[1]]}InvokeComponent({definition:t,args:e,blocks:r}){return[l.InvokeComponent,d.expr(t),d.Positional(e.positional),d.NamedArguments(e.named),r?g.NamedBlocks(r):null]}};function tn({name:t,value:e,namespace:r}){let n=[gt(t.chars),e.chars];return r&&n.push(r),n}function rn({name:t,value:e,namespace:r}){let n=[gt(t.chars),d.expr(e)];return r&&n.push(r),n}function nn(t){return t.component?l.StaticComponentAttr:l.StaticAttr}const Oe=(()=>{const t=typeof module=="object"&&typeof module.require=="function"?module.require:globalThis.require;if(t)try{const e=t("crypto"),r=n=>{const s=e.createHash("sha1");return s.update(n,"utf8"),s.digest("base64").substring(0,8)};return r("test"),r}catch{}return function(){return null}})(),vt={id:Oe};function bt(t,e=vt){const r=new U.Source(t??"",e.meta?.moduleName),[n,s]=It(r,{lexicalScope:()=>!1,...e}),a=function(i,o,u){let y=new Zr(o.table,u),k=w.visitList(o.body,y).mapOk(b=>new Qt({loc:o.loc,scope:o.table,body:b.toArray()}));return u&&(k=k.andThen(b=>Qr.validate(b))),k}(0,n,e.strictMode??!1).mapOk(i=>function(o){let u=g.list(o.body),y=o.scope;return[u,y.symbols,y.upvars]}(i));if(a.isOk)return[a.value,s];throw a.reason}const je="796d24e6-2450-4fb0-8cdf-b65638b5ef70";function sn(t,e=vt){const[r,n]=bt(t,e);"emit"in e&&e.emit?.debugSymbols&&n.length>0&&r.push(n);const s=e.meta?.moduleName,a=e.id||Oe,i=JSON.stringify(r),o={id:a(JSON.stringify(e.meta)+i),block:i,moduleName:s??"(unknown template module)",scope:je,isStrictMode:e.strictMode??!1};n.length===0&&delete o.scope;let u=JSON.stringify(o);if(n.length>0){const y=`()=>[${n.join(",")}]`;u=u.replace(`"${je}"`,y)}return u}const an=Object.freeze(Object.defineProperty({__proto__:null,NEWLINE:Jt,ProgramSymbols:ct,WireFormatDebugger:en,buildStatement:oe,buildStatements:jt,c:qt,defaultId:Oe,precompile:sn,precompileJSON:bt,s:zt,unicode:Rt},Symbol.toStringTag,{value:"Module"})),{precompileJSON:ln}=We(an),{getTemplateLocals:on}=We(Gt);function mn(t,e={}){let r=wt(t),n,s;try{n=At(cn(t,{moduleName:e.moduleName||r,...e}),xt(void 0,"hbs:component"))}catch(a){s=a}return{name:r,component:n,error:s}}function cn(t,{moduleName:e,scope:r={}}){let n={array:Nt,concat:Bt,fn:Ot,get:Ct,hash:St,on:Et,...r},s=on(t),a={strictMode:!0,moduleName:e,locals:s,isProduction:!1,meta:{moduleName:e}},[i,o]=ln(t,a),u=o.map(A=>{let x=n[A];if(!x)throw new Error(`Attempt to use ${A} in compiled hbs, but it was not available in scope. Available scope includes: ${Object.keys(n)}`);return x}),y=JSON.stringify(i);return Tt({id:e,block:y,moduleName:e??"(dynamically compiled component)",scope:()=>u,isStrictMode:!0})}export{mn as compileHBS};
